### 一、ArcGIS中的地理坐标系与投影坐标系及地图投影

### 1、基本概念

**地理坐标系(Geographic Coordinate System)**，是使用三维球面来定义地球表面位置，以实现通过经纬度对地球表面点位引用的坐标系。一个地理坐标系包括角度测量单位、本初子午线和参考椭球体三部分。在球面系统中，水平线是等纬度线或纬线。垂直线是等经度线或经线。

**投影坐标系 (Projection coordinatesystem)，是**平面坐标系统，地图单位通常为米，也称非地球投影坐标系统(notearth)，或者是**平面坐标**。投影坐标系使用基于X,Y值的坐标系统来描述地球上某个点所处的位置。这个坐标系是从地球的近似椭球体投影得到的，它对应于某个地理坐标系。

**地图投影**是利用一定数学法则把地球表面的经、纬线转换到平面上的理论和方法。

### 2、区别与联系

简单来说，**地理坐标系是球面坐标**，参考平面是椭球面，**坐标单位是经纬度**；**投影坐标系是平面坐标系**，参考平面是水平面，**坐标单位是米、千米等**。***地理坐标系转换到投影坐标系的过程理解为投影\***，即将不规则的地球曲面转换为平面。主要有以下几点区别：

1）地理坐标系统是一种球面坐标，而投影坐标系统是平面坐标；

2）投影坐标系统在二维平面上有恒定的长度、角度和面积；

3）投影坐标系统是由地理坐标投影到平面坐标上形成的。

### ArcGIS中我国常用的坐标系统

北京54坐标系——GCS_Beijing_1954（Krasovsky_1940）

西安80坐标系——GCS_Xian_1980（IAG_75）

WGS-84世界大地坐标系——GCS_WGS_1984（WGS_1984）

2000坐标系——GCS_CN_2000（CN_2000）



**ArcGIS的优势:**

1）引擎可拓展性强；

2）可以发布离线版本内网使用；

3）支持各种主流数据库,支持海量数据存储；

4）可进行地图版本管理；

5）支持多种开发语言(javascript/html, flex, silverlight, ios,安卓)；

**ArcGIS的劣势:**

1）数据传输量限制；

2）对服务器的要求高；

**SuperMap的优势：**

\1) 二次开发简洁便利；

\2) 符号库比较符合国情；

**SuperMap的劣势：**

1）数据处理功能较弱；

3）本土化进展赶不上业务发展，一些功能需要二次开发才能满足业务需求；



ArcGIS最强大，但是属国外产品,价格昂贵！尤其是工具箱ArcToolBox绝对是非常领先的！

supermap与MapGIS都属国产，是国内GIS软件平台的佼佼者。

其中MapGIS主要是土地利用方面利用的多，做数据库、输图、统计

超图近些年做得不错，我觉得超图是最有希望超越ArcGIS或者可以与ArcGIS缩短距离的，MapGIS发展我认为不大乐观。



SuperMap的WebGL是基于开源JS库Cesium做的修改而形成的产品

定位方法一（Camera.setView



控制地形的显示与移除
在Cesium的官方API中提供了加载地形的接口terrainProvider，但是没有移除地形的接口，又仔细查看了一下文档，发现viewer中的options大部分都是有默认值的，那么在没有设置加载地形前，terrainProvider也有一个默认值，当加载的地形要移除的时候，将terrainProvider恢复默认值即可。

## webgl的一次绘制，需要经过大致的以下几个阶段。

- 创建webgl的应用程序Program，从文本编译并使用shader
- 将三维几何数据通过attribute传送给GPU
- GPU执行顶点着色器，处理顶点数据
- GPU执行片元着色器，处理颜色等数据
- 将执行结果写入缓冲区（用于显示到屏幕或者后处理）

## 什么是shader

顶点着色器：大部分就是在处理顶点的矩阵变换，将顶点的位置通过MVP矩阵乘法最终变换到裁剪空间。

片元着色器：在整个渲染中起到了非常大的作用，一般颜色，贴图采样，光照，阴影等计算都会在片元着色器中计算。



threejs定位是纯渲染库，从大多数新手反馈来看threejs的入门似乎更加容易一点点。但是，如果你做过threejs的深度定制，大概就能体会到，threejs的源代码似乎并不是十分"优雅"，很多地方你没有办法进行继承扩展，只能hack源码。

babylon是个非常不错的库，从各方面来说，代码的工程化程度较高，从整个工具链上来说 babylon有sandbox playground 材质编辑器 editor等等可用，

**项目中最难的点**

Bixi-graphs 组件库 开发

1 其中最难的点在于坐标系转换，这也是图形学绘制里比较重要的点

2 连线编辑功能的画布局部连线更新 （svg / canvas 图层）

3 图例高亮选中 / 高亮指定路径 （考虑使用 canvas 局部刷新）

4 图上编辑功能，最开始想用局部渲染，最后使用了多图层。

方案：

1 bbox擦除后重绘 (bound2d 包围盒算法)

2 clip裁剪后重绘 有明显的性能问题

局部渲染的流程如下：

- 当 Canvas、Group 和 Shape 发生变化时，将发生变化的元素放入一个队列
- 延迟 16 ms 将队列中的元素影响的包围盒合并
- 将包围盒内的内容清空，重绘包围盒内的图形

出现的问题： 1 性能不好，计算量大



**最近有看什么书**

b站闫令琪老师的图形学课程 games101  向量和矩阵-在图形学中的应用

向量的点乘：两个向量坐标对应x,y,z的值相乘 再 相加，

场景：判断两向量是否为统一方向，>0 则方向相同，夹角在0-90度， =0 则正交，相互垂直， <0 则方向基本相反。

向量的叉乘：两个向量坐标对应（x1,y1,z1）（x2,y2,z2）进行矩阵变换，得到一个法向量，该向量垂直于a和b向量构成的平面。

三维空间里：法向量用于构建x、y、z坐标系。

二维空间里：向量叉乘取模的数值等于两向量构成平行四边形的面积。

矩阵： 可用作2D矩阵变换：缩放()、对称变换, canvas的translate会改变坐标系，需要在平移前使用context.save,绘制后使用context.restore

scale(x,y) 水平和垂直方向上的缩放倍数。不过缩放时对应的坐标也会缩放，线条粗细也会对应缩放

transform变换矩阵，会传入6个参数，水平缩放、水平倾斜、垂直倾斜、垂直缩放、水平位移、垂直位移
